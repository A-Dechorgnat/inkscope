<!DOCTYPE html>
<html>
<head>
    <meta charset=utf-8 />
    <script type="text/javascript" src="scripts/d3/d3.v3.min.js"></script>
    <script src="scripts/d3/common.js"></script>
    <script src="scripts/d3/colorbrewer.js"></script>
</head>
<body>
<script type="text/javascript">

    var attrs = {};
    attrs.colormode = "desc";

    var width = 300,
            height = 150,
            radius = width / 2;
    innerRadius = radius - 60;
    outerRadius = radius - 10;

    var fields = [
        {value: 1, color: "#cccccc", name: "fond"},
        {value: 0, color: "#00FF00", name: "na"}
    ];

    fields[0].previous = fields[0].value = 1;

    var colorFunc;
    if (attrs.colormode == 'asc') colorFunc = color4ascPercent; else colorFunc = color4descPercent;


    var arc = d3.svg.arc()
            .innerRadius(innerRadius)
            .outerRadius(outerRadius)
            .startAngle(-Math.PI / 2)
            .endAngle(function (d) {
                return d.value * Math.PI - Math.PI / 2;
            });

    var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height)
            .append("g")
            .attr("transform", "translate(" + (width / 2) + "," + height + ")");

    setInterval(function () {
        fields[1].previous = fields[1].value;
        fields[1].value = Math.random();
        var percentValue = fields[1].value;

        var path = svg.selectAll("path")
                .data(fields)
                .attr("fill", function (d) {
                    if (d.name == "fond")return d.color; else return colorFunc(d.value);
                });

        path.enter().append("svg:path");

        path.transition()
                .ease("linear")
                .duration(1500)
                .attrTween("d", arcTween)
                .style("fill", function (d) {
                    if (d.name == "fond")return d.color; else return colorFunc(d.value);
                });


        path.exit().transition()
                .ease("bounce")
                .duration(1500)
                .attrTween("d", arcTween)
                .remove();


        svg.selectAll("text").remove();

        var gaugeText = svg.selectAll("text")
                .data([fields[1]])
                .enter()
                .append("text")
                .text(function(d){return (d.value*100).toFixed(1) + " %";})
                .attr("text-anchor", "middle")
                .attr("font-size", "30px")
                .attr("font-family", "arial")
                .transition()
                .duration(1500)
                .tween("text", function(d) {
                    var i = d3.interpolate(d.previous, d.value);
                    return function(t) {
                        this.textContent = (i(t)*100).toFixed(1) + " %";
                    };
                });

    }, 5000);

    function arcTween(b) {
        var i = d3.interpolate({value: b.previous}, b);
        return function(t) {
            return arc(i(t));
        };
    }


</script>
</body>
</html>